- job:
    name: pkgdeb-build-pkg
    node: debian-jessie

    wrappers:
      - build-timeout:
          timeout: 30
      - timestamps

    builders:
    - gerrit-git-prep
    - shell: |
          #!/bin/bash -xe

          # Add OpenStack Infra internal repositories to APT source lists
          sudo ln -s \
          /etc/apt/sources.list.available.d/debian-openstack-newton.list \
          /etc/apt/sources.list.d/debian-openstack-newton.list
          # Install the build env...
          sudo apt-get update
          sudo apt-get install -y openstack-pkg-tools
          sudo pkgos-infra-install-sbuild
          # ...and build
          pkgos-infra-build-pkg

    publishers:
      - console-log

- job:
    name: pkgdeb-publish-pkg
    node: debian-jessie

    wrappers:
      - build-timeout:
          timeout: 30
      - timestamps

    builders:
    - gerrit-git-prep
    - shell: |
          #!/bin/bash -xe

          # Add OpenStack Infra internal repositories to APT source lists
          sudo ln -s \
          /etc/apt/sources.list.available.d/debian-openstack-newton.list \
          /etc/apt/sources.list.d/debian-openstack-newton.list
          # Install the build env...
          sudo apt-get update
          sudo apt-get install -y openstack-pkg-tools
          sudo pkgos-infra-install-sbuild
          # ...and build
          pkgos-infra-build-pkg

    publishers:
      - deb-pkgs:
          project: deb-pkg
      - console-log
